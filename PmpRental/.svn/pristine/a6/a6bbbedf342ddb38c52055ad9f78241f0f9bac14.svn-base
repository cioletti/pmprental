<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" height="100%" xmlns:control="br.com.thinklab.util.control.*" xmlns:controls="fs.controls.*">
	<mx:Script>
		<![CDATA[
			import bean.BusinessGroupBean;
			import bean.ClienteBean;
			import bean.ConfigManutencaoBean;
			import bean.ConfigManutencaoHorasBean;
			import bean.ConfigurarTracaoBean;
			import bean.ContratoComercialBean;
			import bean.FamiliaBean;
			import bean.FilialBean;
			import bean.ModeloBean;
			import bean.MotNaoFecContratoBean;
			import bean.PrefixoBean;
			import bean.RangerBean;
			import bean.StatusContratoBean;
			import bean.TipoContratoBean;
			import bean.UsuarioBean;
			
			import flash.utils.flash_proxy;
			
			import mx.collections.ArrayCollection;
			import mx.controls.Alert;
			import mx.core.IFlexDisplayObject;
			import mx.events.CloseEvent;
			import mx.events.ListEvent;
			import mx.events.ValidationResultEvent;
			import mx.managers.PopUpManager;
			import mx.rpc.events.ResultEvent;
			import mx.utils.ObjectUtil;
			import mx.utils.StringUtil;
			import mx.validators.Validator;
			
			import util.ProgressBarHelper;
			private var urlLogin:String;
			private var myValidators:Array;
			private var urlReport:String = "";
			private var _usuarioBean:UsuarioBean;
			[Bindable] 
			private var contrato:ContratoComercialBean = new ContratoComercialBean();
			public function init(urlLogin:String, usuarioBean:UsuarioBean):void{
				this._usuarioBean = usuarioBean;
				this.telComercial.inputFormat = FormattedInput.INPUT_FORMAT_FONE_DDD;
				this.telServicos.inputFormat = FormattedInput.INPUT_FORMAT_FONE_DDD;
				this.urlLogin = urlLogin;
				serviceController.findAllModelosContrato('N');
				serviceController.findAllTipoContratoRental();
				serviceController.findAllStatusContrato();
				serviceController.getUrlReportServer();
				serviceController.findAllMotNaoFecContrato();
				serviceController.findAllFamilia('N');
				serviceController.findAllBusinessGroupContrato();
				serviceController.findAllFilial();
			}
			[Bindable]
			private var comboModelo:ArrayCollection = new ArrayCollection();	
			private function onResultFindAllModelos(event:ResultEvent):void{
				modeloCbx.selectedIndex = -1;
				prefixoCbx.selectedIndex = -1;
				manutHoras.dataProvider = null;
				range.dataProvider = null;
				if(comboModelo.length > 0){
					comboModelo.removeAll();
				}
				if(comboPrefixo.length > 0){
					comboPrefixo.removeAll();
				}
				comboModelo.addAll(ArrayCollection(event.result));
				if(contExcessao.selected ==  false){
					this.selectedBusinessPM();
				}else{
					ProgressBarHelper.removeProgressBar();
				}
			}
			[Bindable]
			private var comboPrefixo:ArrayCollection = new ArrayCollection();
			[Bindable]
			private var comboFamilia:ArrayCollection = new ArrayCollection();	
			private function onResultFindAllPrefixos(event:ResultEvent):void{
				if(comboPrefixo.length > 0){
					comboPrefixo.removeAll();
				}
				comboPrefixo.addAll(ArrayCollection(event.result));
				prefixoCbx.dataProvider = comboPrefixo;
			}
			private function onResultFindAllBusinessGroup(event:ResultEvent):void{
				bgCbx.dataProvider = event.result;
				this.selectedBusinessPM();
			}
			private function onResultFindAllRanger(event:ResultEvent):void{
				range.dataProvider = ArrayCollection(event.result);
			}
			private function onResultFindAllTipoContrato(event:ResultEvent):void{
				tipoContratoCbx.dataProvider = ArrayCollection(event.result);
			}
			private function onResultFindAllStatusContrato(event:ResultEvent):void{
				statusContratoCbx.dataProvider = ArrayCollection(event.result);
				this.fixStatusContrato();
			}
			private function onResultFindDataNomeCliente(event:ResultEvent):void{
				this.popupCliente(ArrayCollection(event.result));
			}
			private function onResultFindAllManutencaoHoras(event:ResultEvent):void{
				manutHoras.dataProvider = ArrayCollection(event.result);
			}
//			private function onResultFindAllContratoComercial(event:ResultEvent):void{
//				gridPesquisaContrato.dataProvider = ArrayCollection(event.result);
//			}
			private function onResultGetUrlReportServer(event:ResultEvent):void{
				urlReport = String(event.result);
			}
			private function onResultFindAllMotNaoFecContrato(event:ResultEvent):void{
				motNaoFecContratoCbx.dataProvider = event.result;
			}
			private function onResultFindAllParcelas(event:ResultEvent):void{
				
				var preco:PrecoPmp = new PrecoPmp();
				preco.addEventListener(CloseEvent.CLOSE, removePopUpPreco);
				PopUpManager.addPopUp(preco,this,true);
				PopUpManager.centerPopUp(preco)
				preco.percentWidth = 400;
				preco.percentHeight = 300;
				preco.gridPrecos.dataProvider = event.result;
			}
			
			private function removePopUpPreco(obj:CloseEvent):void{
				PopUpManager.removePopUp(obj.currentTarget as IFlexDisplayObject);
			}
			private var valorContrato:ValorContrato = new ValorContrato();
			private function removePopUpValorContrato(obj:CloseEvent):void{
				if(valorContrato.isSave == true){
					this.contrato = valorContrato.contrato;
					PopUpManager.removePopUp(obj.currentTarget as IFlexDisplayObject);
				}
			}
			
			private function setContrato():void{
				//contrato = ContratoComercialBean(gridPesquisaContrato.selectedItem);
				//nomeCliente.text = contrato.nomeCliente;
				numeroContrato.text = contrato.numeroContrato;
				codigoCliente.text = contrato.codigoCliente;
				modeloCbx.selectedIndex = -1;
				prefixoCbx.selectedIndex = -1;
				manutHoras.dataProvider = null;
				manutHoras.dataProvider = contrato.configManutencaoHorasBeanList;
				range.dataProvider = null;
				range.dataProvider = contrato.rangerList;
				idEquipamento.text = contrato.idEquipamento;
				if(comboModelo.length > 0){
					comboModelo.removeAll();
				}
				if(comboPrefixo.length > 0){
					comboPrefixo.removeAll();
				}
				modeloCbx.dataProvider = null;
				//prefixoCbx.dataProvider = null;
				comboModelo.addAll(contrato.modeloList);
				modeloCbx.dataProvider = comboModelo;
				comboPrefixo.addAll(contrato.prefixoList);
				//prefixoCbx.dataProvider = comboPrefixo;
				checkTa.selected = (contrato.TA == 'S')?true:false; 
				
				horimetro.text = String(contrato.horimetro);
				numeroSerie.text = contrato.serie.substr(4, contrato.serie.length -1);
				
				
				telComercial.text = contrato.telComercial;
				razaoSocial.text = contrato.razaoSocial;
				//contatoComercial.text = contrato.contatoComercial;
				
				var familiaList:ArrayCollection = ArrayCollection(familiaCbx.dataProvider);
				for(var i:int=0; i < familiaList.length; i++){
					var familia:FamiliaBean = FamiliaBean(familiaList.getItemAt(i));
					if(contrato.familia == familia.descricao){
						familiaCbx.selectedIndex = i;
						break;
					}
				}
				
				contExcessao.selected = (contrato.contExcessao == 'S')?true:false;
				
				cidade.text = contrato.cidade;
				endereco.text = contrato.endereco;
				bairro.text = contrato.bairro;
				cnpj.text = contrato.cnpj;
				inscEstadual.text = contrato.inscEstadual;
				inscMunicipal.text = contrato.inscMunicipal;
				contribuinte.text = contrato.contribuinte;
				procurador.text = contrato.procurador;
				cpf.text = contrato.cpf;
				emailContatoComercial.text = contrato.emailComercial;
				contatoServicos.text = contrato.contatoServicos;
				emailContatoServicos.text = contrato.emailServicos;
				telServicos.text = contrato.telServicos;
				fabricante.text = contrato.fabricante;
				uf.text = contrato.uf;
				cep.text = contrato.cep;
				//faxServicos.text = contrato.faxServicos;
				condExcepcional.text = contrato.condExcepcional;
				emailCheckList.text = contrato.emailCheckList;
				horimetroMensal.text = String(contrato.mediaHorasMes);
				this.selectedModelo();
				this.selectedPrefixo();
				this.selectedBusinessGroup();
				this.selectedTipoContrato();
				this.selectedStatusContrato();
				this.selectedRanger();
				this.selectedParcelas();
				this.selectedFilial();
				if(contrato.configTracaoList != null && contrato.configTracaoList.length > 0){
					formTracao.includeInLayout = true;
					formTracao.visible = true;
					comboTracao.removeAll();
					comboTracao.addAll(contrato.configTracaoList);
					tracaoCbx.dataProvider = comboTracao;
					this.selectedConfigTracao();
				}else{
					comboTracao.removeAll();
					tracaoCbx.dataProvider = comboTracao;
					formTracao.includeInLayout = false;
					formTracao.visible = false;
				}
				
				if(contrato.tipoCustomizacaoList != null && contrato.tipoCustomizacaoList.length > 0){
					formTipoCustomizacao.includeInLayout = true;
					formTipoCustomizacao.visible = true;
					listTipoCustomizacao.removeAll();
					listTipoCustomizacao.addAll(contrato.tipoCustomizacaoList);
					tipoCustomizacaoList.dataProvider = listTipoCustomizacao;
				}else{
					listTipoCustomizacao.removeAll();
					tipoCustomizacaoList.dataProvider = listTipoCustomizacao;
					formTipoCustomizacao.includeInLayout = false;
					formTipoCustomizacao.visible = false;
				}
				motNaoFecContratoCbx.selectedIndex = -1;
				changeComboStatus();
				this.motivoNaoFechamentoContrato();
				if(statusContratoCbx.selectedIndex > 0 && StatusContratoBean(statusContratoCbx.selectedItem).sigla == 'CA'){
					salvarContrato.includeInLayout = false;
					salvarContrato.visible = false;
				}else{
					salvarContrato.includeInLayout = true;
					salvarContrato.visible = true;
				}
				
			}
			
			private function selectedModelo():void{
				var modeloList:ArrayCollection = ArrayCollection(modeloCbx.dataProvider);
				for(var i:int=0; i < modeloList.length; i++){
					var modelo:ModeloBean = ModeloBean(modeloList.getItemAt(i));
					if(contrato.modelo == modelo.descricao){
						modeloCbx.selectedIndex = i;
						break;
					}
				}
			}
			private function selectedPrefixo():void{
				for(var i:int=0; i < comboPrefixo.length; i++){
					var prefixo:PrefixoBean = PrefixoBean(comboPrefixo.getItemAt(i));
					if(contrato.prefixo == prefixo.descricao){
						prefixoCbx.selectedIndex = i;
						break;
					}
				}
			}
			private function selectedBusinessGroup():void{
				var bgList:ArrayCollection = ArrayCollection(bgCbx.dataProvider);
				for(var i:int=0; i < bgList.length; i++){
					var bg:BusinessGroupBean = BusinessGroupBean(bgList.getItemAt(i));
					if(contrato.businessGroup == bg.descricao){
						bgCbx.selectedIndex = i;
						break;
					}
				}
			}
			private function selectedTipoContrato():void{
				var tpList:ArrayCollection = ArrayCollection(tipoContratoCbx.dataProvider);
				for(var i:int=0; i < tpList.length; i++){
					var tp:TipoContratoBean = TipoContratoBean(tpList.getItemAt(i));
					if(contrato.idTipoContrato == tp.id){
						tipoContratoCbx.selectedIndex = i;
						break;
					}
				}
			}
			private function selectedStatusContrato():void{
				var scList:ArrayCollection = ArrayCollection(statusContratoCbx.dataProvider);
				for(var i:int=0; i < scList.length; i++){
					var sc:StatusContratoBean = StatusContratoBean(scList.getItemAt(i));
					if(contrato.statusContrato == sc.id){
						statusContratoCbx.selectedIndex = i;
						break;
					}
				}
			}
			private function selectedFilial():void{
				var filialList:ArrayCollection = ArrayCollection(filialCbx.dataProvider);
				for(var i:int=0; i < filialList.length; i++){
					var f:FilialBean = FilialBean(filialList.getItemAt(i));
					if(contrato.idFilialDestino == f.stno){
						filialCbx.selectedIndex = i;
						break;
					}
				}
			}
			private function fixStatusContrato():void{
				var scList:ArrayCollection = ArrayCollection(statusContratoCbx.dataProvider);
				for(var i:int=0; i < scList.length; i++){
					var sc:StatusContratoBean = StatusContratoBean(scList.getItemAt(i));
					if(sc.sigla == "CA"){
						statusContratoCbx.selectedIndex = i;
						break;
					}
				}
			}
			
			private function selectedRanger():void{
				var rangerList:ArrayCollection = ArrayCollection(range.dataProvider);
				for(var i:int=0; i < rangerList.length; i++){
					var rg:RangerBean = RangerBean(rangerList.getItemAt(i));
					if(contrato.beginRanger == rg.beginRanger && contrato.endRanger == rg.endRanger){
						range.selectedIndex = i;
						break;
					}
				}
			}
			private function selectedParcelas():void{
				var parcelasList:ArrayCollection = ArrayCollection(parcelasCbx.dataProvider);
				for(var i:int=0; i < parcelasList.length; i++){
					if(contrato.qtdParcelas == parcelasList.getItemAt(i).valor){
						parcelasCbx.selectedIndex = i;
						break;
					}
				}
			}
			
			private function motivoNaoFechamentoContrato():void{
				var mnfcList:ArrayCollection = ArrayCollection(motNaoFecContratoCbx.dataProvider);
				for(var i:int=0; i < mnfcList.length; i++){
					if(contrato.idMotNaoFecContrato == MotNaoFecContratoBean(mnfcList.getItemAt(i)).id){
						motNaoFecContratoCbx.selectedIndex = i;
						break;
					}
				}
			}
			
			private function selectedConfigTracao():void{
				var tracaoList:ArrayCollection = ArrayCollection(tracaoCbx.dataProvider);
				for(var i:int=0; i < tracaoList.length; i++){
					if(contrato.idConfigTracao == ConfigurarTracaoBean(tracaoList.getItemAt(i)).id){
						tracaoCbx.selectedIndex = i;
						break;
					}
				}
			}
			
			
			
			private function onResultSaveOrUpdate(event:ResultEvent):void{
				if(event.result != null){
					contrato = ContratoComercialBean(event.result);
					
					//Alert.show("Contrato salvo com sucesso!", "Alerta");
					numeroContrato.text = contrato.numeroContrato;
					//gridPesquisaContrato.dataProvider = null;

					valorContrato.addEventListener(CloseEvent.CLOSE, removePopUpValorContrato);
					PopUpManager.addPopUp(valorContrato,this,true);
					PopUpManager.centerPopUp(valorContrato);
					valorContrato.initRenta(urlLogin, parcelasCbx.selectedItem.valor,contrato, TipoContratoBean(tipoContratoCbx.selectedItem).sigla,  FilialBean(filialCbx.selectedItem).stno);
					if(statusContratoCbx.selectedIndex > 0 && StatusContratoBean(statusContratoCbx.selectedItem).sigla == 'CA'){
						salvarContrato.includeInLayout = false;
						salvarContrato.visible = false;
					}else{
						salvarContrato.includeInLayout = true;
						salvarContrato.visible = true;
					}
					return;
				}
				Alert.show("Não foi possível salvar contrato verifique se o mesmo possui configuração de preço!", "Alerta");
			}
				
		
		
//			private function alertClickHandler(event:CloseEvent):void {
//				if (event.detail==Alert.YES) {
//					//Alert.show("Contrato salvo com sucesso!", "Alerta");
//					numeroContrato.text = contrato.numeroContrato;
//					//gridPesquisaContrato.dataProvider = null;
//					
//					valorContrato.addEventListener(CloseEvent.CLOSE, removePopUpValorContrato);
//					PopUpManager.addPopUp(valorContrato,this,true);
//					PopUpManager.centerPopUp(valorContrato);
//					valorContrato.init(urlLogin, parcelasCbx.selectedItem.valor,contrato, TipoContratoBean(tipoContratoCbx.selectedItem).sigla);
//					if(statusContratoCbx.selectedIndex > 0 && StatusContratoBean(statusContratoCbx.selectedItem).sigla == 'CA'){
//						salvarContrato.includeInLayout = false;
//						salvarContrato.visible = false;
//					}else{
//						salvarContrato.includeInLayout = true;
//						salvarContrato.visible = true;
//					}
//					return;
//				}
//			}
			[Bindable]
			private var cliente:Cliente = new Cliente();
			public function popupCliente(clienteList:ArrayCollection):void{
				
				cliente.addEventListener(CloseEvent.CLOSE, removePopUpCliente);
				PopUpManager.addPopUp(cliente,this,true);
				PopUpManager.centerPopUp(cliente)
				cliente.percentWidth = 400;
				cliente.percentHeight = 300;
				cliente.init(clienteList);
				
				
			}
			
			private function removePopUpCliente(obj:CloseEvent):void{
				PopUpManager.removePopUp(obj.currentTarget as IFlexDisplayObject);
				if(cliente.gridClientes.selectedItem != null){
					if(ClienteBean(cliente.gridClientes.selectedItem).FLAGDELETE == 'N' || ClienteBean(cliente.gridClientes.selectedItem).FLAGDELETE == ''){
						this.setCliente(ClienteBean(cliente.gridClientes.selectedItem));
					}						
				}				
			}
			
			private function validateHorasManut():Boolean{
				var horasList:ArrayCollection = ArrayCollection(manutHoras.dataProvider);
				var totalHoras:Number = 0;
				var intervalo:Number = 0;
				for(var i:int = 0; i < horasList.length; i++){
					var beanHoras:ConfigManutencaoHorasBean = ConfigManutencaoHorasBean(horasList.getItemAt(i));
					if(i == 0){
						var beanHorasProximo:ConfigManutencaoHorasBean = ConfigManutencaoHorasBean(horasList.getItemAt(i+1));
						if(beanHoras.horas < beanHorasProximo.horas){
							intervalo = beanHorasProximo.horas - beanHoras.horas;
						}else{
							intervalo = beanHorasProximo.horas;
						}
					}else{
						var beanHorasUltima:ConfigManutencaoHorasBean = ConfigManutencaoHorasBean(horasList.getItemAt(horasList.length - 1));
						var beanHorasPenultima:ConfigManutencaoHorasBean = ConfigManutencaoHorasBean(horasList.getItemAt(horasList.length - 2));
						intervalo = beanHorasUltima.horas - beanHorasPenultima.horas;
					}
					if(beanHoras.isSelected == true){
						totalHoras+=intervalo;
					}
				}
				if(totalHoras < 1000){
					return false;
				}
				return true;
			}
			
			
			
			
			private function validarHorimetroIntervaloHoras():Boolean{
				var horasList:ArrayCollection = ArrayCollection(manutHoras.dataProvider);
				var result:ArrayCollection = new ArrayCollection();
				var beanHoras:ConfigManutencaoHorasBean = new ConfigManutencaoHorasBean();
				var frequencia:Number = 0;
				var horimetroReferencia:Number = Number(horimetro.text);
				for(var i:int = 0; i < horasList.length; i++){
					beanHoras = ConfigManutencaoHorasBean(horasList.getItemAt(i));
					frequencia = beanHoras.frequencia;
					if(beanHoras.isSelected == true){
						result.addItem(ObjectUtil.copy(beanHoras));
						if(Number(horimetro.text) > beanHoras.horasManutencao){
							return false;
						}
					}
				}
				var beanHorasAux:ConfigManutencaoHorasBean = result.getItemAt(0) as ConfigManutencaoHorasBean;
				
				if(Number(horimetro.text) > beanHorasAux.horasManutencao || (Number(horimetro.text)+frequencia) < beanHorasAux.horasManutencao){
					return false;
				}
				beanHoras = new ConfigManutencaoHorasBean();
				beanHorasAux = new ConfigManutencaoHorasBean();
				for(var j:int = 0; j < result.length; j++){
					if(j+1 == result.length ){
						return true;
					}
					
					beanHoras = result.getItemAt(j) as ConfigManutencaoHorasBean;
					beanHorasAux = result.getItemAt(j+1) as ConfigManutencaoHorasBean;
					frequencia = beanHoras.frequencia;
					if(j > 0 && (beanHoras.horasManutencao + frequencia) != beanHorasAux.horasManutencao){
						return false;
					}
					if(j == 0){
						frequencia = beanHoras.frequencia;
						if((beanHoras.horasManutencao + frequencia) != beanHorasAux.horasManutencao){
							return false;
						}
					}
				}
				return true;
				
				
			}

//			private function findStandardJob():ArrayCollection{
//				var horasList:ArrayCollection = ArrayCollection(manutHoras.dataProvider);
//				var standardJobList:ArrayCollection = new ArrayCollection();
//				for(var i:int = 0; i < horasList.length; i++){
//					var beanHoras:ConfigManutencaoHorasBean = ConfigManutencaoHorasBean(horasList.getItemAt(i));
//					if(beanHoras.isSelected == true){
//						standardJobList.addItem(beanHoras);
//					}
//				}
//				return standardJobList;
//			}
			
			private function findStandardJob():ArrayCollection{
				var horasList:ArrayCollection = ArrayCollection(manutHoras.dataProvider);
				var standardJobList:ArrayCollection = new ArrayCollection();
				var isPosPago:Boolean = false;
				for(var i:int = 0; i < horasList.length; i++){
					var beanHoras:ConfigManutencaoHorasBean = ConfigManutencaoHorasBean(horasList.getItemAt(i));
					if(beanHoras.isSelected == true){
						if(StatusContratoBean(statusContratoCbx.selectedItem).sigla == 'CA'){
							isPosPago = true;
						}
						standardJobList.addItem(beanHoras);
					}else if(isPosPago == true){
						standardJobList.addItem(beanHoras);
					}
				}
				return standardJobList;
			}
			
			private function saveContrato():void {
				
				myValidators = new Array();
				
				if(tracaoCbx.dataProvider != null && tracaoCbx.selectedIndex == -1 && ArrayCollection(tracaoCbx.dataProvider).length > 0){
					Alert.show("Selecione um Tipo de Tração para o contrato!", "Alerta");
					return;
				}
				
				if(bgCbx.selectedItem == null){
					Alert.show("Selecione um Business Group para o contrato!", "Alerta");
					return;
				}
				if(statusContratoCbx.selectedItem == null){
					Alert.show("Selecione um status para o contrato!", "Alerta");
					return;
				}
				if(statusContratoCbx.selectedItem != null && StatusContratoBean(statusContratoCbx.selectedItem).sigla == 'CNA'){
					myValidators.push(campoMotNaoFecContratoCbx);
				}
				if(statusContratoCbx.selectedItem != null && StatusContratoBean(statusContratoCbx.selectedItem).sigla == 'CEN' || StatusContratoBean(statusContratoCbx.selectedItem).sigla == 'CNA'){
//					myValidators.push(campofamiliaCbx);
//					myValidators.push(campoModeloCbx);
//					myValidators.push(campoPrefixoCbx);
//					myValidators.push(campoBgCbx);
//					myValidators.push(campoNumeroSerie);
//					myValidators.push(campoRanger);
//					myValidators.push(campoHorimetro);
//					myValidators.push(campoCodigoCliente);
//					myValidators.push(campoTipoContrato);
//					//myValidators.push(campoStatusContrato);
//					myValidators.push(campoRazaoSocial);
//					myValidators.push(campoFabricante);
//					myValidators.push(campoUf);
//					myValidators.push(campoCep);
//					myValidators.push(campoTelComercial);
					
					myValidators.push(campofamiliaCbx);
					myValidators.push(campoModeloCbx);
					myValidators.push(campoPrefixoCbx);
					myValidators.push(campoBgCbx);
					myValidators.push(campoNumeroSerie);
					myValidators.push(campoRanger);
					myValidators.push(campoHorimetro);
					myValidators.push(campoHorimetroMensal);
					myValidators.push(campoCodigoCliente);
					myValidators.push(campoTipoContrato);
					//myValidators.push(campoStatusContrato);
					myValidators.push(campoRazaoSocial);
					myValidators.push(campoFabricante);
					myValidators.push(campoUf);
					myValidators.push(campoCep);
					myValidators.push(campoCidade);
					myValidators.push(campoEndereco);
					myValidators.push(campoBairro);
					myValidators.push(campoTelComercial);
					myValidators.push(campoEmailContatoComercial);
					//myValidators.push(campoFaxComercial);
					myValidators.push(campoContatoServicos);
					myValidators.push(campoTelServicos);
					myValidators.push(campoEmailContatoServicos);
					//myValidators.push(campoFaxServicos);
					myValidators.push(campoInscEstadual);
					myValidators.push(campoInscMunicipal);
					myValidators.push(campoContribuinte);
					myValidators.push(campoProcurador);
					myValidators.push(campoCpf);
					myValidators.push(campoCnpj);
					myValidators.push(campoIdEquipamento);
					myValidators.push(campoFilialCbx);
				}else{
					
					myValidators.push(campofamiliaCbx);
					myValidators.push(campoModeloCbx);
					myValidators.push(campoPrefixoCbx);
					myValidators.push(campoBgCbx);
					myValidators.push(campoNumeroSerie);
					myValidators.push(campoRanger);
					myValidators.push(campoHorimetro);
					myValidators.push(campoHorimetroMensal);
					myValidators.push(campoCodigoCliente);
					myValidators.push(campoTipoContrato);
					//myValidators.push(campoStatusContrato);
					myValidators.push(campoRazaoSocial);
					myValidators.push(campoFabricante);
					myValidators.push(campoUf);
					myValidators.push(campoCep);
					myValidators.push(campoCidade);
					myValidators.push(campoEndereco);
					myValidators.push(campoBairro);
					myValidators.push(campoTelComercial);
					myValidators.push(campoEmailContatoComercial);
					//myValidators.push(campoFaxComercial);
					myValidators.push(campoContatoServicos);
					myValidators.push(campoTelServicos);
					myValidators.push(campoEmailContatoServicos);
					//myValidators.push(campoFaxServicos);
					myValidators.push(campoInscEstadual);
					myValidators.push(campoInscMunicipal);
					myValidators.push(campoContribuinte);
					myValidators.push(campoProcurador);
					myValidators.push(campoCpf);
					myValidators.push(campoCnpj);
					myValidators.push(campoIdEquipamento);
					myValidators.push(campoFilialCbx);
					
				}
				var validatorErrorArray:Array = Validator.validateAll(myValidators);;
				var isValidForm:Boolean = validatorErrorArray.length == 0;
				if (isValidForm) {
					if(BusinessGroupBean(bgCbx.selectedItem).descricao != 'KIT2' && BusinessGroupBean(bgCbx.selectedItem).descricao != 'KIT3' )
						if(this.validateHorasManut() == false){
							Alert.show("Não é premitido selecionar um intervalo de horas menor que 1000!", "Alerta");
							return;
						}

						if(validarHorimetroIntervaloHoras() == false){
							Alert.show("O horímetro não está conforme o intervalo de manutenção selecionado!", "Alerta");
							return;
						}
						//contrato.nomeCliente = nomeCliente.text.toUpperCase();
						contrato.idTipoContrato = Number(TipoContratoBean(tipoContratoCbx.selectedItem).id);
						contrato.statusContrato = Number(StatusContratoBean(statusContratoCbx.selectedItem).id);
						contrato.TA = (checkTa.selected == true)?'S':'N';
						contrato.businessGroup = BusinessGroupBean(bgCbx.selectedItem).descricao;
						contrato.horimetro = Number(horimetro.text);
						contrato.mediaHorasMes = Number(horimetroMensal.text);
						contrato.numeroSerie = numeroSerie.text.toUpperCase();
						contrato.modelo = ModeloBean(modeloCbx.selectedItem).descricao.toUpperCase();
						contrato.telComercial = telComercial.text.toUpperCase();
						contrato.razaoSocial = razaoSocial.text.toUpperCase();
						//contrato.contatoComercial = contatoComercial.text.toUpperCase();
						contrato.familia = FamiliaBean(familiaCbx.selectedItem).descricao;
						contrato.idFamilia = FamiliaBean(familiaCbx.selectedItem).id;
						contrato.configManutencaoHorasBeanList = this.findStandardJob();
						contrato.qtdParcelas = Number(parcelasCbx.selectedItem.valor);
						contrato.prefixo = PrefixoBean(prefixoCbx.selectedItem).descricao;
						contrato.beginRanger = RangerBean(range.selectedItem).beginRanger;
						contrato.endRanger = RangerBean(range.selectedItem).endRanger;
						contrato.financiado = (parcelasCbx.selectedItem.valor > 1)?'S':'N';
						contrato.contExcessao = (contExcessao.selected)?'S':'N';
						
						if(StatusContratoBean(statusContratoCbx.selectedItem).sigla == 'CNA'){
							contrato.idMotNaoFecContrato = MotNaoFecContratoBean(motNaoFecContratoCbx.selectedItem).id;
						}
						contrato.codigoCliente = codigoCliente.text;
						contrato.cidade = cidade.text.toUpperCase();
						contrato.endereco = endereco.text.toUpperCase();
						contrato.bairro = bairro.text.toUpperCase();
						contrato.cnpj = cnpj.text.toUpperCase();
						contrato.inscEstadual = inscEstadual.text.toUpperCase();
						contrato.inscMunicipal = inscMunicipal.text.toUpperCase();
						contrato.contribuinte = contribuinte.text.toUpperCase();
						contrato.procurador = procurador.text.toUpperCase();
						contrato.cpf = cpf.text.toUpperCase();
						contrato.emailComercial = emailContatoComercial.text.toUpperCase();
						contrato.contatoServicos = contatoServicos.text.toUpperCase();
						contrato.emailServicos = emailContatoServicos.text.toUpperCase();
						contrato.telServicos = telServicos.text.toUpperCase();
						contrato.fabricante = fabricante.text.toUpperCase();
						contrato.uf = uf.text.toUpperCase();
						contrato.cep = cep.text.toUpperCase();
						contrato.condExcepcional = condExcepcional.text;
						contrato.distanciaGerador = null;
						contrato.emailCheckList = emailCheckList.text;
						contrato.idEquipamento = idEquipamento.text;
						contrato.idFilialDestino = FilialBean(filialCbx.selectedItem).stno;
						if(tracaoCbx.dataProvider != null && tracaoCbx.selectedIndex != -1 && ArrayCollection(tracaoCbx.dataProvider).length > 0){
							contrato.idConfigTracao = ConfigurarTracaoBean(tracaoCbx.selectedItem).id;
						}else{
							contrato.idConfigTracao = null;
						}
						//Envia o tipo de customização se existir
						if(listTipoCustomizacao.length > 0){
							contrato.tipoCustomizacaoList = ArrayCollection(tipoCustomizacaoList.dataProvider);
						}else{
							contrato.tipoCustomizacaoList = new ArrayCollection();
						}
						this.validarRenovacaoContrato();
					
				} else {
					var err:ValidationResultEvent;
					var errorMessageArray:Array = [];
					for each (err in validatorErrorArray) {
						var errField:String = FormItem(err.currentTarget.source.parent).label
						errorMessageArray.push(errField + ": Este campo é obrigatório.");
					}
					Alert.show(errorMessageArray.join("\n\n"), "Preencha Por favor...", Alert.OK);
				}
			}
			
			private function validarRenovacaoContrato():void{
				serviceController.validarRenovacaoContrato(contrato);
			}
			
			private function onResultValidarRenovacaoContrato(event:ResultEvent):void{
				contrato = ContratoComercialBean(event.result);
				if(contrato.msg != null && contrato.msg.length > 0){
					Alert.yesLabel = "Sim";
					Alert.noLabel = "Não";
					Alert.show(contrato.msg+"?", "Alerta", 3, this, alertClickHandler);
				}else{
					serviceController.saveOrUpdate(contrato, "N");
				}
			}
			private function alertClickHandler(event:CloseEvent):void {
				if (event.detail==Alert.YES) {
					serviceController.saveOrUpdate(contrato);
				}
			}
			
			private function novoContrato():void{
				formTracao.includeInLayout = false;
				formTracao.visible = false;
				formTipoCustomizacao.includeInLayout = false;
				formTipoCustomizacao.visible = false;
				salvarContrato.includeInLayout = true;
				salvarContrato.visible = true;
				contrato = new ContratoComercialBean();
				numeroContrato.text = "";
				contExcessao.selected = false;
				changeContratoExcessao();
				//nomeCliente.text = "";
				motNaoFecContratoCbx.selectedIndex = -1;
				formNaoFecContrato.includeInLayout = false;
				formNaoFecContrato.visible= false;
				//tipoContratoCbx.selectedIndex = -1;
				//statusContratoCbx.selectedIndex = -1;
				checkTa.selected = false;
				bgCbx.selectedIndex = -1;
				horimetro.text = "";
				numeroSerie.text = "";
				modeloCbx.selectedIndex = -1;
				telComercial.text = "";
				razaoSocial.text = "";
				//contatoComercial.text = "";
				familiaCbx.selectedIndex = -1;
				manutHoras.dataProvider = null;
				//parcelas.selectedIndex = -1;
				comboPrefixo.removeAll();
				//prefixoCbx.dataProvider = null;
				range.dataProvider = null;
				contrato.endRanger = "";
				//parcelas.text = ""
				codigoCliente.text = "";
				cidade.text = "";
				endereco.text = "";
				bairro.text = "";
				cnpj.text = "";
				inscEstadual.text = "";
				inscMunicipal.text = "";
				contribuinte.text = "";
				procurador.text = "";
				cpf.text.toUpperCase();
				emailContatoComercial.text = "";
				contatoServicos.text = "";;
				emailContatoServicos.text = "";
				telServicos.text = "";
				fabricante.text = "";
				uf.text = "";
				cep.text = "";
				condExcepcional.text = "";
				cpf.text = "";
				emailCheckList.text="";
				idEquipamento.text = "";
				filialCbx.selectedIndex = -1;
			}
			private function onResultFindDataCliente(event:ResultEvent):void{
				if((event.result as ClienteBean).msg != null){
					Alert.show((event.result as ClienteBean).msg, "Alerta");
					return;
				}
				this.setCliente(event.result as ClienteBean);
			}
			
			private function setCliente(cliente:ClienteBean):void{
				contrato.cliente = cliente;
				razaoSocial.text = cliente.RAZSOC;
				cidade.text = cliente.CID;
				endereco.text = cliente.END;
				bairro.text = cliente.BAIRRO;
				codigoCliente.text = cliente.CLCHAVE;
				cpf.text = cliente.CPF;
				cnpj.text = cliente.CNPJ;
				inscEstadual.text = cliente.INSCEST;
				inscMunicipal.text = cliente.INSCMUN;
				uf.text = cliente.EST;
				cep.text = cliente.CEP;
				if(cliente.INDCONT == 'Y'){
					contribuinte.text = "SIM";
				}else{
					contribuinte.text = "NÃO";
				}
			}
			[Bindable]
			private var comboTracao:ArrayCollection = new ArrayCollection();
			[Bindable]
			private var listTipoCustomizacao:ArrayCollection = new ArrayCollection();	
			private function onChangeModelo():void{
				fabricante.text = "";
				//bgCbx.selectedIndex = -1;
				manutHoras.dataProvider = null;
				range.dataProvider = null;				
				serviceController.findAllPrefixosContrato(ModeloBean(modeloCbx.selectedItem).descricao, (contExcessao.selected == true)?'S':'N');
				serviceController.findAllConfigTracao(ModeloBean(modeloCbx.selectedItem).idModelo);
				serviceController.findAllConfigCustomizacao(ModeloBean(modeloCbx.selectedItem).idModelo);
			}
			private function onResultFindAllConfigTracao(event:ResultEvent):void{
				var result:ArrayCollection = ArrayCollection(event.result);
				if(result.length > 0){
					formTracao.includeInLayout = true;
					formTracao.visible = true;
				}else{
					formTracao.includeInLayout = false;
					formTracao.visible = false;
				}
				comboTracao.removeAll();
				comboTracao.addAll(ArrayCollection(event.result));
				tracaoCbx.dataProvider = comboTracao;
			}
			
			private function onResultFindAllConfigCustomizacao(event:ResultEvent):void{
				var result:ArrayCollection = ArrayCollection(event.result);
				if(result.length > 0){
					formTipoCustomizacao.includeInLayout = true;
					formTipoCustomizacao.visible = true;
				}else{
					formTipoCustomizacao.includeInLayout = false;
					formTipoCustomizacao.visible = false;
				}
				listTipoCustomizacao.removeAll();
				listTipoCustomizacao.addAll(ArrayCollection(event.result));
				tipoCustomizacaoList.dataProvider = listTipoCustomizacao;
			}
			private function onChangePrefixo():void{
				//bgCbx.selectedIndex = -1;
				manutHoras.dataProvider = null;
				serviceController.findAllRangerContrato(ModeloBean(modeloCbx.selectedItem).descricao, PrefixoBean(prefixoCbx.selectedItem).descricao, (contExcessao.selected == true)?'S':'N',null);
				serviceController.findFabricante(PrefixoBean(prefixoCbx.selectedItem).descricao);
			}
			
			private function onResultFindFabricante(event:ResultEvent):void{
				fabricante.text = String(event.result).split("-")[0];	
				contrato.make = String(event.result).split("-")[1];		
			}
			
			private function findCliente():void{
				if(clienteText.text == ""){
					Alert.show("O campo de cliente deve ser preenchido!");
					return;
				}
				if(answers.selection.id == "codigo"){
					serviceController.findDataCliente(clienteText.text);
				}else{
					serviceController.findDataNomeCliente(clienteText.text);
				}
				
			}
			private function popularManutHoras():void{
				if(bgCbx.selectedItem != null){
					serviceController.findAllManutencaoHoras(ModeloBean(modeloCbx.selectedItem).descricao, PrefixoBean(prefixoCbx.selectedItem).descricao, RangerBean(range.selectedItem).beginRanger, RangerBean(range.selectedItem).endRanger, BusinessGroupBean(bgCbx.selectedItem).descricao,(contExcessao.selected == true)?'S':'N',null);
				}else{
					range.selectedIndex = -1;
					Alert.show("Por favor selecione um Business Group!", "Alerta");
				}
			}
			private function changeContratoExcessao():void{
				contratoPdf.visible = false;
				var isExcessao:String = (contExcessao.selected == true)?'S':'N';
				if(isExcessao == 'S'){
					this.selectedBusinessSev();
				}else{
					this.selectedBusinessPM();
				}
				serviceController.findAllModelosContrato(isExcessao);
				comboFamilia.removeAll();
				serviceController.findAllFamilia(isExcessao);
				familiaCbx.selectedIndex = -1;
				modeloCbx.selectedIndex = -1;
				comboModelo.removeAll();
				
				
			}
			
		
			public function generatePDF():void
			{				
				var uv:URLVariables = new URLVariables();
				uv.idStatusContrato = contrato.statusContrato;
				uv.idContrato = contrato.id;
				uv.isAdministrador = 'CON'
				var url:URLRequest = new URLRequest(urlReport);
				url.method = "GET";
				url.data = uv;
				navigateToURL(url,"_blank");
				
			}
			private function changeComboStatus():void{
				
				if(statusContratoCbx.selectedIndex > 0){
					formNaoFecContrato.includeInLayout=(statusContratoCbx.selectedItem.sigla == 'CNA')?true:false; 
					formNaoFecContrato.visible=(statusContratoCbx.selectedItem.sigla == 'CNA')?true:false
				}else{
					formNaoFecContrato.includeInLayout = false;
					formNaoFecContrato.visible= false;
				}
			}

			
			private function changeComboBg():void{
				if(BusinessGroupBean(bgCbx.selectedItem).descricao == 'KIT3' || BusinessGroupBean(bgCbx.selectedItem).descricao == 'KIT2'){
					manutHoras.enabled = false;
					checkTa.selected = false;
					checkTa.includeInLayout = false;
					checkTa.visible = false;
				}else{
					manutHoras.enabled = true;
					checkTa.includeInLayout = true;
					checkTa.visible = true;
				}
			}
			
			private var pesquisaContrato:PesquisaContratoRental = new PesquisaContratoRental();
			private function pesquisa_clickHandler(event:MouseEvent):void{
				pesquisaContrato.addEventListener(CloseEvent.CLOSE, removePopUpPesquisaContrato);
				PopUpManager.addPopUp(pesquisaContrato,this,true);
				pesquisaContrato.width= 1000;
				pesquisaContrato.height = 600;
				PopUpManager.centerPopUp(pesquisaContrato)
				pesquisaContrato.init(urlLogin, urlReport);
				//pesquisaContrato.gridPesquisaContrato.dataProvider = event.result;
			}
			private function removePopUpPesquisaContrato(obj:CloseEvent):void{
				PopUpManager.removePopUp(obj.currentTarget as IFlexDisplayObject);
				if(pesquisaContrato.contrato != null){
					contrato = pesquisaContrato.contrato;
					setContrato();
				}
			}
			private function onResultFindAllFamilia(event:ResultEvent):void{
				comboFamilia.addAll(ArrayCollection(event.result));
			}
			private function selectedBusinessSev():void{
				var bgList:ArrayCollection = ArrayCollection(bgCbx.dataProvider);
				for(var i:int=0; i < bgList.length; i++){
					var bg:BusinessGroupBean = BusinessGroupBean(bgList.getItemAt(i));
					if('SEV' == bg.descricao){
						bgCbx.selectedIndex = i;
						break;
					}
				}
			}
			private function selectedBusinessPM():void{
				var bgList:ArrayCollection = ArrayCollection(bgCbx.dataProvider);
				for(var i:int=0; i < bgList.length; i++){
					var bg:BusinessGroupBean = BusinessGroupBean(bgList.getItemAt(i));
					if('PM' == bg.descricao){
						bgCbx.selectedIndex = i;
						break;
					}
				}
			}
			protected function familiaCbx_changeHandler(event:ListEvent):void
			{
				fabricante.text = "";
				formTracao.includeInLayout = false;
				formTracao.visible = false;
				formTipoCustomizacao.includeInLayout = false;
				formTipoCustomizacao.visible = false;
				serviceController.findAllModelosContrato((contExcessao.selected == true)?'S':'N', familiaCbx.selectedItem.id, "N");
			}
			private function onResultFindAllFilial(event:ResultEvent):void{
				filialCbx.dataProvider = ArrayCollection(event.result);
				this.selectedFilialCbx();
			} 
			
			private function selectedFilialCbx():void{
				var filialList:ArrayCollection = ArrayCollection(filialCbx.dataProvider);
				for(var i:int=0; i < filialList.length; i++){
					var f:FilialBean = FilialBean(filialList.getItemAt(i));
					if(_usuarioBean != null && Number(_usuarioBean.filial) == f.stno){
						filialCbx.selectedIndex = i;
						break;
					}
				}
			}
			private function selectNewFilial():void{
				//serviceController.changeUser(FilialBean(filialCbx.selectedItem).stno);
				//_usuarioBean.filial = String(FilialBean(filialCbx.selectedItem).stno);
			}
		]]>
	</mx:Script>
	
	
	<mx:ArrayCollection id="parcelasColl">
		
		<mx:Object label="1 Parcela" valor="1"/>
		<mx:Object label="2 Parcela" valor="2"/>
		<mx:Object label="3 Parcela" valor="3"/>
		<mx:Object label="4 Parcela" valor="4"/>
		<mx:Object label="5 Parcela" valor="5"/>
		<mx:Object label="6 Parcela" valor="6"/>
		<mx:Object label="7 Parcela" valor="7"/>
		<mx:Object label="8 Parcela" valor="8"/>
		<mx:Object label="9 Parcela" valor="9"/>
		<mx:Object label="10 Parcela" valor="10"/>
		
		
	</mx:ArrayCollection>  
	
	<!--mx:StringValidator id="campoFamilia" requiredFieldError="Este campo  obrigatório!" required="true" source="{familia}" property="text" /-->
	<mx:NumberValidator id="campoModeloCbx" source="{modeloCbx}" lowerThanMinError="Este campo  obrigatório." property="selectedIndex" minValue="0" />
	<mx:NumberValidator id="campoPrefixoCbx" source="{prefixoCbx}" lowerThanMinError="Este campo  obrigatório." property="selectedIndex" minValue="0" />
	<mx:NumberValidator id="campoBgCbx" source="{bgCbx}" lowerThanMinError="Este campo  obrigatório." property="selectedIndex" minValue="0" />
	<mx:StringValidator id="campoNumeroSerie" requiredFieldError="Este campo  obrigatório!" required="true" source="{numeroSerie}" property="text" />
	<mx:NumberValidator id="campoRanger" source="{range}" lowerThanMinError="Este campo  obrigatório." property="selectedIndex" minValue="0" />
	<mx:StringValidator id="campoHorimetro" requiredFieldError="Este campo  obrigatório!" required="true" source="{horimetro}" property="text" />
	<mx:StringValidator id="campoHorimetroMensal" requiredFieldError="Este campo  obrigatório!" required="true" source="{horimetroMensal}" property="text" />
	<mx:StringValidator id="campoCep" requiredFieldError="Este campo  obrigatório!" required="true" source="{cep}" property="text" />
	<mx:NumberValidator id="campoTipoContrato" source="{tipoContratoCbx}" lowerThanMinError="Este campo  obrigatório." property="selectedIndex" minValue="0" />
	<!--mx:NumberValidator id="campoStatusContrato" source="{statusContratoCbx}" lowerThanMinError="Este campo  obrigatório." property="selectedIndex" minValue="0" /-->
	<mx:NumberValidator id="campoMotNaoFecContratoCbx" source="{motNaoFecContratoCbx}" lowerThanMinError="Este campo  obrigatório." property="selectedIndex" minValue="0" />
	<mx:StringValidator id="campoRazaoSocial" requiredFieldError="Este campo  obrigatório!" required="true" source="{razaoSocial}" property="text" />
	<mx:StringValidator id="campoCnpj" requiredFieldError="Este campo  obrigatório!" required="true" source="{cnpj}" property="text" />
	<mx:StringValidator id="campoFabricante" requiredFieldError="Este campo  obrigatório!" required="true" source="{fabricante}" property="text" />
	<mx:StringValidator id="campoUf" requiredFieldError="Este campo  obrigatório!" required="true" source="{uf}" property="text" />
	<mx:StringValidator id="campoCidade" requiredFieldError="Este campo  obrigatório!" required="true" source="{cidade}" property="text" />
	<mx:StringValidator id="campoEndereco" requiredFieldError="Este campo  obrigatório!" required="true" source="{endereco}" property="text" />
	<mx:StringValidator id="campoBairro" requiredFieldError="Este campo  obrigatório!" required="true" source="{bairro}" property="text" />
	<!--mx:StringValidator id="campoContatoComercial" requiredFieldError="Este campo  obrigatório!" required="true" source="{contatoComercial}" property="text" /-->
	<mx:StringValidator id="campoTelComercial" requiredFieldError="Este campo  obrigatório!" required="true" source="{telComercial}" property="text" />
	<mx:EmailValidator id="campoEmailContatoComercial" requiredFieldError="Este campo é obrigatório!" missingAtSignError="E-mail deve conter @" required="true" source="{emailContatoComercial}" property="text" />
	<!--mx:StringValidator id="campoFaxComercial" requiredFieldError="Este campo  obrigatório!" required="true" source="{faxComercial}" property="text" /-->
	<mx:StringValidator id="campoContatoServicos" requiredFieldError="Este campo  obrigatório!" required="true" source="{contatoServicos}" property="text" />
	<mx:StringValidator id="campoTelServicos" requiredFieldError="Este campo  obrigatório!" required="true" source="{telServicos}" property="text" />
	<mx:EmailValidator id="campoEmailContatoServicos" requiredFieldError="Este campo é obrigatório!" missingAtSignError="E-mail deve conter @" required="true" source="{emailContatoServicos}" property="text" />
	<!--mx:StringValidator id="campoFaxServicos" requiredFieldError="Este campo  obrigatório!" required="true" source="{faxServicos}" property="text" /-->
	<mx:StringValidator id="campoInscEstadual" requiredFieldError="Este campo  obrigatório!" required="true" source="{inscEstadual}" property="text" />
	<mx:StringValidator id="campoInscMunicipal" requiredFieldError="Este campo  obrigatório!" required="true" source="{inscMunicipal}" property="text" />
	<mx:StringValidator id="campoContribuinte" requiredFieldError="Este campo  obrigatório!" required="true" source="{contribuinte}" property="text" />
	<mx:StringValidator id="campoProcurador" requiredFieldError="Este campo  obrigatório!" required="true" source="{procurador}" property="text" />
	<mx:StringValidator id="campoCpf" requiredFieldError="Este campo  obrigatório!" required="true" source="{cpf}" property="text" />
	<mx:StringValidator id="campoCodigoCliente" requiredFieldError="Este campo  obrigatório!" required="true" source="{codigoCliente}" property="text" />
	<mx:StringValidator id="campoIdEquipamento" requiredFieldError="Este campo  obrigatório!" required="true" source="{idEquipamento}" property="text" />
	<mx:NumberValidator id="campofamiliaCbx" source="{familiaCbx}" lowerThanMinError="Este campo  obrigatório." property="selectedIndex" minValue="0" />
	<mx:NumberValidator id="campoFilialCbx" source="{filialCbx}" lowerThanMinError="Este campo  obrigatório." property="selectedIndex" minValue="0" />
	
	<mx:RemoteObject destination="service" invoke="{ProgressBarHelper.openProgressBar(this)}" id="serviceController" showBusyCursor="true" fault="{ProgressBarHelper.erro(event,urlLogin);ProgressBarHelper.removeProgressBar();}">
		<mx:method name="findAllModelosContrato" result="onResultFindAllModelos(event);ProgressBarHelper.removeProgressBar()" />
		<mx:method name="findAllPrefixosContrato" result="onResultFindAllPrefixos(event);ProgressBarHelper.removeProgressBar()" />
		<mx:method name="findAllBusinessGroupContrato" result="onResultFindAllBusinessGroup(event);ProgressBarHelper.removeProgressBar()" />
		<mx:method name="findAllRangerContrato" result="onResultFindAllRanger(event);ProgressBarHelper.removeProgressBar()" />
		<mx:method name="findAllTipoContratoRental" result="onResultFindAllTipoContrato(event);ProgressBarHelper.removeProgressBar()" />
		<mx:method name="findAllStatusContrato" result="onResultFindAllStatusContrato(event);ProgressBarHelper.removeProgressBar()" />
		<mx:method name="findDataCliente" result="onResultFindDataCliente(event);ProgressBarHelper.removeProgressBar()" />
		<mx:method name="findDataNomeCliente" result="onResultFindDataNomeCliente(event);ProgressBarHelper.removeProgressBar()" />
		<mx:method name="findAllManutencaoHoras" result="onResultFindAllManutencaoHoras(event);ProgressBarHelper.removeProgressBar()" />
		<mx:method name="saveOrUpdate" result="onResultSaveOrUpdate(event);ProgressBarHelper.removeProgressBar()" />
		<!--mx:method name="findAllContratoComercialRental" result="onResultFindAllContratoComercial(event);ProgressBarHelper.removeProgressBar()" /-->
		<mx:method name="getUrlReportServer" result="onResultGetUrlReportServer(event);ProgressBarHelper.removeProgressBar()" />
		<mx:method name="findAllParcelas" result="onResultFindAllParcelas(event);ProgressBarHelper.removeProgressBar()" />
		<mx:method name="findAllMotNaoFecContrato" result="onResultFindAllMotNaoFecContrato(event);ProgressBarHelper.removeProgressBar()" />
		<mx:method name="findAllFamilia" result="onResultFindAllFamilia(event);ProgressBarHelper.removeProgressBar()" />
		<mx:method name="validarRenovacaoContrato" result="onResultValidarRenovacaoContrato(event)" />
		<mx:method name="findAllConfigTracao" result="onResultFindAllConfigTracao(event);ProgressBarHelper.removeProgressBar()" />
		<mx:method name="findFabricante" result="onResultFindFabricante(event);ProgressBarHelper.removeProgressBar()" />
		<mx:method name="findAllConfigCustomizacao" result="onResultFindAllConfigCustomizacao(event);ProgressBarHelper.removeProgressBar()" />
		<mx:method name="findAllFilial" result="onResultFindAllFilial(event);ProgressBarHelper.removeProgressBar()" />
	</mx:RemoteObject>
	<mx:HBox x="0" y="31" width="100%" height="391" horizontalScrollPolicy="auto" verticalScrollPolicy="auto" horizontalAlign="center">
		<mx:Form>
			<mx:FormItem label="Destino" required="true" >
				<mx:ComboBox editable="true" id="filialCbx" labelField="stnm" prompt="Selecione" change="selectNewFilial()" visible="true"/>
			</mx:FormItem>
			<mx:FormItem label="Número Contrato" required="false" width="261">
				<mx:Label text="" id="numeroContrato"/>
			</mx:FormItem>
			<mx:FormItem label="Tipo" includeInLayout="false" visible="false">
				<mx:CheckBox label="APLICAÇÃO SEVERA" change="changeContratoExcessao()" id="contExcessao"/>
			</mx:FormItem>
			<mx:FormItem label="Família" required="true" >
				<mx:ComboBox x="48" y="1" id="familiaCbx" dataProvider="{comboFamilia}" change="familiaCbx_changeHandler(event)"  labelField="descricao"   prompt="Selecione" selectedIndex="-1"/>
			</mx:FormItem>
			<mx:FormItem label="Modelo" required="true">
				<mx:ComboBox x="48" y="1" id="modeloCbx" dataProvider="{comboModelo}" labelField="descricao" change="onChangeModelo()"  prompt="Selecione" selectedIndex="-1"/>
			</mx:FormItem>
			<mx:FormItem label="Customizações" id="formTipoCustomizacao" visible="false" includeInLayout="false">
				<mx:List id="tipoCustomizacaoList" width="194" labelField="descricao" alternatingItemColors="[#EEEEEE, white]" rowCount="5" toolTip="Selecione as customizações de configurações!" height="76">
					<mx:itemRenderer>
						<mx:Component>
							<mx:CheckBox selectedField="isSelected"
										 change="onChange(event);" selected="{data.isSelected}">
								<mx:Script>
									<![CDATA[
										private function onChange(evt:Event):void {
											data.isSelected = this.selected;
										}
									]]>
								</mx:Script>
							</mx:CheckBox>
						</mx:Component>
					</mx:itemRenderer>
				</mx:List>
			</mx:FormItem>
			<mx:FormItem label="Tração" required="true" id="formTracao" visible="false" includeInLayout="false">
				<mx:ComboBox x="48" y="1" id="tracaoCbx"  dataProvider="{comboTracao}" labelField="descricao" change=""  prompt="Selecione" selectedIndex="-1"/>
			</mx:FormItem>
			<mx:FormItem label="Prefixo" required="true">
				<mx:ComboBox x="53" y="3" id="prefixoCbx" change="onChangePrefixo()" dataProvider="{comboPrefixo}" labelField="descricao"  prompt="Selecione" selectedIndex="-1"/>
			</mx:FormItem>
			<mx:FormItem label="Business Group" required="true">
				<mx:ComboBox x="54" y="-1" id="bgCbx" enabled="false" labelField="descricao" change="range.selectedIndex = -1; manutHoras.dataProvider = null; changeComboBg();" prompt="Selecione" selectedIndex="-1"/>
			</mx:FormItem>
			<mx:FormItem label="Número de Série" required="true" width="282">
				<mx:TextInput id="numeroSerie" width="151" maxChars="30" />
			</mx:FormItem>
			<mx:FormItem label="Ranger" required="true" width="280" height="94">
				<mx:List height="84" id="range" labelField="descricao" change="popularManutHoras()" width="158"></mx:List>
			</mx:FormItem>
		</mx:Form>
		<mx:Form>
			<mx:FormItem label="Horímetro Atual" required="true" width="300">
				<mx:TextInput id="horimetro" width="86" maxChars="10" restrict="0-9"/>
			</mx:FormItem>
			<mx:FormItem label="Média Hor. Mensal" required="true" width="100%">
				<mx:TextInput id="horimetroMensal" width="86" maxChars="10" restrict="0-9"/>
			</mx:FormItem>
			<mx:FormItem includeInLayout="false" visible="false">
				<mx:CheckBox label="TA (Análise de Desempenho)" id="checkTa"/>
			</mx:FormItem>
			<mx:FormItem label="Parcelas" required="false" width="279">

				<mx:HBox verticalAlign="middle">	
					<mx:ComboBox id="parcelasCbx" labelField="label" dataProvider="{parcelasColl}"  enabled="false"/>
					<mx:Image source="img/money.png" width="29" height="22" buttonMode="true" click="(serviceController.findAllParcelas(contrato.id))" visible="false"/>
				</mx:HBox>

			</mx:FormItem>
			<mx:FormItem label="Tipo de Contrato" required="true" width="314">
				<mx:ComboBox x="48" y="1" id="tipoContratoCbx" labelField="descricao" />
			</mx:FormItem>
			<mx:FormItem label="Status do contrato" required="true" width="321">
				<mx:ComboBox x="48" y="1" id="statusContratoCbx" enabled="false" labelField="descricao" change="changeComboStatus()"  prompt="Selecione" selectedIndex="-1" width="198"/>
			</mx:FormItem>
			<mx:FormItem label="Manutenções">
				<mx:List id="manutHoras" width="194" labelField="horasManutencao" alternatingItemColors="[#EEEEEE, white]" rowCount="5" toolTip="Selecione no mínimo um ciclo de 1000 horas">
					<mx:itemRenderer>
						<mx:Component>
							<mx:CheckBox selectedField="isSelected"
										 change="onChange(event);" selected="{data.isSelected}">
								<mx:Script>
									<![CDATA[
										private function onChange(evt:Event):void {
											data.isSelected = this.selected;
										}
									]]>
								</mx:Script>
							</mx:CheckBox>
						</mx:Component>
					</mx:itemRenderer>
				</mx:List>
			</mx:FormItem>
			<mx:FormItem label="Buscar Cliente" horizontalAlign="center"  borderStyle="solid" cornerRadius="5" borderColor="#FFCC33">
				<mx:HBox verticalAlign="middle">
					<mx:VBox>
						<mx:RadioButtonGroup id="answers" />
						<mx:RadioButton group="{answers}" id="codigo" label="Código" selected="true"/>
						<mx:RadioButton group="{answers}" id="nome" label="Nome"/>
						
					</mx:VBox>
					<mx:VBox horizontalAlign="center">
						<mx:TextInput id="clienteText" width="122"/>
						<mx:Button label="Buscar" click="findCliente()"/>
					</mx:VBox>
				</mx:HBox>	
			</mx:FormItem>
			<mx:FormItem label="Código Cliente" required="true" width="316">
				<mx:TextInput id="codigoCliente" width="141" maxChars="20" restrict="0-9"/>
			</mx:FormItem>
		</mx:Form>
		<mx:Form height="363">
			<mx:FormItem label="ID Equip." required="true" width="288">
				<mx:TextInput id="idEquipamento" width="169" maxChars="255"/>
			</mx:FormItem>
			
			<mx:FormItem label="Fabricante" required="true" width="288">
				<mx:TextInput id="fabricante" width="169" maxChars="255"/>
			</mx:FormItem>
			<mx:FormItem label="UF" required="true" width="288">
				<mx:TextInput id="uf" width="169" maxChars="255"/>
			</mx:FormItem>
			<mx:FormItem label="Cidade" required="true" width="288">
				<mx:TextInput id="cidade" width="169" maxChars="255"/>
			</mx:FormItem>
			<mx:FormItem label="Endereço" required="true" width="287">
				<mx:TextInput id="endereco" width="169" maxChars="255"/>
			</mx:FormItem>
			<mx:FormItem label="Bairro" required="true" width="283">
				<mx:TextInput id="bairro" maxChars="255"/>
			</mx:FormItem>
			<mx:FormItem label="CEP" required="true" width="282">
				<mx:TextInput id="cep" maxChars="255"/>
			</mx:FormItem>
			<mx:FormItem label="CPF/CNPJ" required="true" width="278">
				<mx:TextInput id="cnpj" maxChars="30" width="144"/>
			</mx:FormItem>
			<mx:FormItem label="Razão Social" required="true" width="281">
				<mx:TextInput id="razaoSocial" width="161" maxChars="255"/>
			</mx:FormItem>
			<mx:FormItem label="Insc. Estadual" required="true" width="280">
				<mx:TextInput id="inscEstadual" maxChars="30"/>
			</mx:FormItem>
			<mx:FormItem label="Insc. Municipal" required="true" width="280">
				<mx:TextInput id="inscMunicipal" maxChars="30"/>
			</mx:FormItem>
			<mx:FormItem label="Contribuinte" required="true" width="281">
				<mx:TextInput id="contribuinte" maxChars="200"/>
			</mx:FormItem>
		</mx:Form>
		<mx:Form height="345">
			<mx:FormItem label="Rep. do Cliente" required="true" width="277">
				<mx:TextInput id="procurador" maxChars="200"/>
			</mx:FormItem>
			<mx:FormItem label="CPF Rep." required="true" width="322">
				<mx:TextInput id="cpf" maxChars="20"/>
			</mx:FormItem>
			<mx:FormItem label="Tel. Representante" required="true" width="316">
				<controls:FormattedInput id="telComercial" maxChars="15" width="102"/>
			</mx:FormItem>
			<mx:FormItem label="Rep. do Cliente Email:" required="true" width="319">
				<mx:TextInput id="emailContatoComercial" maxChars="255" width="164"/>
			</mx:FormItem>
			<mx:FormItem label="Contato Serviços" required="true" width="318">
				<mx:TextInput id="contatoServicos" maxChars="255" width="164"/>
			</mx:FormItem>
			<mx:FormItem label="Telefone Serviços" required="true" width="323">
				<controls:FormattedInput id="telServicos" maxChars="15" width="102"/>
			</mx:FormItem>
			<mx:FormItem label="E-mail Serviços" required="true" width="320">
				<mx:TextInput id="emailContatoServicos" maxChars="255" width="164"/>
			</mx:FormItem>
			<mx:FormItem label="Condição expcional" width="316" height="82" includeInLayout="false" visible="false">
				<mx:TextArea height="75" id="condExcepcional" maxChars="100" width="164"/>
			</mx:FormItem>
			<mx:FormItem label="E-mails CheckList">
				<mx:TextArea id="emailCheckList" toolTip="Adicione os emails separando cada um deles por ponto e virgula (;)."/>
			</mx:FormItem>
		</mx:Form>
	</mx:HBox>
	<mx:ApplicationControlBar x="0" y="0"  width="100%" horizontalAlign="center">
		<mx:Label text="Contrato de RENTAL de PMP" fontWeight="bold"/>
	</mx:ApplicationControlBar>
	<mx:VBox x="0" y="458" width="100%" height="100%">
		<mx:HBox paddingLeft="20" width="100%">
			<mx:Grid width="100%">
				<mx:GridRow width="100%" height="100%">
					<mx:GridItem width="100%" height="100%" verticalAlign="middle" horizontalAlign="center">
						<mx:Button label="Salvar" id="salvarContrato" click="saveContrato()" enabled="{(isNaN(contrato.idMotNaoFecContrato) || contrato.idMotNaoFecContrato == 0)?true:false}"/>
						<mx:Button label="Novo" click="novoContrato()"/>
						<mx:Button label="Pesquisar" id="pesquisa" click="pesquisa_clickHandler(event)"/>
						<mx:Image source="img/contrato.png" width="33" id="contratoPdf" click="generatePDF()" buttonMode="true" height="23" visible="{(contrato.numeroContrato != null &amp;&amp; (isNaN(contrato.idMotNaoFecContrato) || contrato.idMotNaoFecContrato == 0))?true:false}"/>
					</mx:GridItem>
				</mx:GridRow>
			</mx:Grid>
		</mx:HBox>
	</mx:VBox>
	<mx:FormItem label="Mot. não Fechamento Contrato" id="formNaoFecContrato" includeInLayout="false" visible="false" required="true"  x="427" y="428">
		<mx:ComboBox x="48" y="1" id="motNaoFecContratoCbx" labelField="descricao"  prompt="Selecione" selectedIndex="-1" />
	</mx:FormItem>
</mx:Canvas>
